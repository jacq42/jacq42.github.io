---
layout: post
title:  Neuerungen in Java 10
tags: [ Java ]
author: jacq42
excerpt_separator: <!--more-->
color: rgb(0, 100,100)
---

Welche Neuerungen wurden mit Java 10 implementiert?

<!--more-->

## LocalVariable Type inference

Bisher:
```java
String name = "Dies ist ein String";

Map<Integer, String> idToNameMap = new HashMap<>();
```

Jetzt:
```java
var name = "Dies ist ein String";

var idToNameMap = new HashMap<Integer, String>();
```

* Java erkennt den Typ jetzt automatisch
* ist nur möglich für lokale Variablen mit einem Initializer
* Fokus liegt dadurch auf dem Namen der Variable und nicht auf deren Typ
* sollte nur angewendet werden, wenn dadurch der Typ nicht "verloren" geht

```java
var result = obj.process();
```
Das wäre zulässig, aber der Typ wäre nicht erkennbar.

## Unmodifiable Collections

* anstatt wie bisher z.B. `java.util.Collections.unmodifiableSet(originalSet)` zu verwenden, kann jetzt einfach ein `Set.copyOf(originalSet)` passieren
* kann auf `java.util.List`, `java.util.Map` und `java.util.Set` angewendet werden
* auch gibt es bei der Verwendung von Streams jetzt ein `java.util.stream.Collectors.toUnmodifiableList()` (auch wieder für List, Map und Set)

## Optional.orElseThrow()

* Optionals haben jetzt ein `orElseThrow()`, das eine Exception wirft, wenn kein Wert vorhanden ist
* gilt für `java.util.Optional`, `java.util.OptionalDouble`, `java.util.OptionalInt` und `java.util.OptionalLong`

## Performance Verbesserungen

### Parallel Full GC for G1

* seit Java9 ist G1 Standard
* für einen Full GC wurde ein singelsingle threaded mark-sweep-compact Algorithmus verwendet
* jetzt ein parallel mark-sweep-compact Algorithmus
* dadurch wird die Zeit des Stillstands für einen Full GC reduziert

### Application Class-Data Sharing

* seit Java5 gibt es ein Class-Data Sharing
* Klassen könnnen in einem geteilten Archiv abgelegt und zur Laufzeit genutzt werden, um die Startzeit für Anwendungen zu verringern
* können von mehreren JVMs genutzt werden
* bisher nur für Systemklassen, jetzt auch für Klassen der Applikation
* war ein commercial feature in Java8 und Java9, jetzt frei für alle
* Vorgehen: für HelloWorld Anwendung
    1. Liste von Klassen für das Archiv erstellen: `$ java -Xshare:off -XX:+UseAppCDS -XX:DumpLoadedClassList=hello.lst \ 
    -cp hello.jar HelloWorld`
    2. Archiv erstellen: `$ java -Xshare:dump -XX:+UseAppCDS -XX:SharedClassListFile=hello.lst \
    -XX:SharedArchiveFile=hello.jsa -cp hello.jar`
    3. Archiv nutzen: `$ java -Xshare:on -XX:+UseAppCDS -XX:SharedArchiveFile=hello.jsa \
    -cp hello.jar HelloWorld`

### Experimental JIT Compiler

* [Graal](https://github.com/oracle/graal/blob/master/compiler/README.md) kann als JIT Compiler genutzt werden: `-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler`

## Container Awareness

* JVMs liefern wenn sie im Container laufen containerspezifische Informationen anstatt der des Operatingsystems (Anzahl der CPUs, Memory)
* nur für linuxbasierte Plattformen
* Verhalten ist per Default angeschaltet und kann ausgeschaltet werden: `-XX:-UseContainerSupport`
* man kann auch angeben, wieviele CPUs die JVM nutzen darf: `-XX:ActiveProcessorCount=count`
* neue Parameter, um im Dockercontainer Memoryeinstellungen vorzunehmen:
```
-XX:InitialRAMPercentage
-XX:MaxRAMPercentage
-XX:MinRAMPercentage
```

## Root Certificates

* es gibt ein Set von Root Certificates im cacerts keystore, die für verschiedene Protokolle genutzt werden können

## Entfernt

* Tool _javah_ (hat C Header erzeugt): jetzt javac -h
* policytool (UI zur Erstellung und Verwaltung von policyfiles): jetzt Texteditor
* Parameter java -Xprof (Profile das laufende Programm): jetzt jmap 
* Deprecated `java.security.acl` -> `java.security.Policy`
* Deprecated `java.security.{Certificate,Identity,IdentityScope,Signer}`

## Time-Based Release Versioning

* ein neues Javarelease alle 6 Monate (= Feature Releases mit min. 1-2 neuen Features)
* Support for neue Featurereleases nur 6 Monate (bis zum nächsten Featurerelease)
* LTS Realeases als solche markiert: Support für 3 Jahre
* Java 11 = LTS


## Weitere Informationen

* [Java Upgrade examples](https://github.com/johanjanssen/JavaUpgrades)
* Von Baeldung [Java 10 Features](https://www.baeldung.com/java-10-new-features)